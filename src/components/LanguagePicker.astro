---
import { languages } from "../i18n/ui";
import { useTranslatedPath } from "../i18n/utils";
import { getLangFromUrl, getRouteFromUrl } from "../i18n/utils";
import languageSolidFull from '../assets/language-solid-full.svg'

const availableLanguages = Object.entries(languages).filter(([lang, label]) => lang != getLangFromUrl(Astro.url));
const { fullName, ...rest } = Astro.props;

const translatePath = useTranslatedPath();
const route = getRouteFromUrl(Astro.url);
---

<div class="lang-switch">
    <img id="lang-icon" src={languageSolidFull.src} width="20rem" alt="Cambiar idioma" />
    <ul id="lang-menu" class="hidden">
        {
            availableLanguages.map(([lang, label]) => (
                <a href={translatePath(`/${route ? route : ''}`, lang)} {...rest}>
                    <li>{fullName ? label : lang}</li>
                </a>
            ))
        }
    </ul>
</div>

<style>
    .lang-switch {
        position: relative;
        display: inline-block;
    }

    #lang-icon {
        padding: 0 20px;
        cursor: pointer;
    }

    #lang-menu {
        padding: 0.5rem 0;
        text-align: end;
        position: absolute;
        top: 2.5rem;
        right: 10px;
        background-color: rgba(255 255 255 / 0.9);
        border-radius: 8px;
        width: 160px;
        z-index: 20;
        list-style: none;
        margin: 0;
        min-width: 100px;
        color: #222222;
    }

    #lang-menu li {
        padding: 6px 10px;
        cursor: pointer;
    }

    #lang-menu li:hover {
        color: #F35889;
        transition: all 0.2s linear ;
    }

    .hidden {
        display: none;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const langIcon = document.getElementById("lang-icon");
        const langMenu = document.getElementById("lang-menu");

        langIcon.addEventListener("click", () => {
            langMenu.classList.toggle("hidden");
        });

        document.addEventListener("click", (e) => {
            if (!e.target.closest(".lang-switch")) {
                langMenu.classList.add("hidden");
            }
        });
    });
</script>